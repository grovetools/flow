{
  "jobs": [
    {
      "title": "setup-database",
      "type": "agent",
      "depends_on": [],
      "prompt": "Set up the PostgreSQL database schema for the User Profile API:\n\n- Create migration files in `migrations/` directory\n- Implement all tables: users, roles, user_roles, user_profiles, user_preferences, refresh_tokens, api_keys\n- Include all indexes and constraints as specified in the refined schema\n- Create Prisma schema file at `prisma/schema.prisma` with all models\n- Set up seed data for default roles (user, admin, moderator)\n- Create database connection utilities in `src/db/connection.ts`"
    },
    {
      "title": "implement-auth-service",
      "type": "agent",
      "depends_on": ["setup-database"],
      "prompt": "Implement the authentication service layer:\n\n- Create `src/services/auth.service.ts` with methods for registration, login, logout\n- Implement JWT token generation and validation utilities in `src/utils/jwt.ts`\n- Create refresh token management with rotation in `src/services/token.service.ts`\n- Implement email verification service in `src/services/email.service.ts`\n- Add password hashing utilities using bcrypt in `src/utils/crypto.ts`\n- Create authentication middleware in `src/middleware/auth.middleware.ts`"
    },
    {
      "title": "create-api-endpoints",
      "type": "agent",
      "depends_on": ["implement-auth-service"],
      "prompt": "Create all REST API endpoints for the User Profile system:\n\n- Implement auth routes in `src/routes/auth.routes.ts`: register, login, refresh, logout\n- Create user profile routes in `src/routes/profile.routes.ts`: GET/PUT profile, upload picture\n- Implement preferences routes in `src/routes/preferences.routes.ts`: GET/PUT preferences\n- Add input validation middleware using express-validator\n- Implement rate limiting middleware in `src/middleware/rateLimit.middleware.ts`\n- Configure CORS and security headers in `src/middleware/security.middleware.ts`"
    },
    {
      "title": "add-file-upload",
      "type": "agent",
      "depends_on": ["create-api-endpoints"],
      "prompt": "Implement profile picture upload functionality:\n\n- Set up AWS S3 client configuration in `src/config/aws.ts`\n- Create file upload service in `src/services/upload.service.ts` with image processing\n- Implement multer middleware for handling multipart uploads\n- Add image validation (file type, size limits)\n- Generate pre-signed URLs for secure image access\n- Update profile routes to handle picture uploads"
    },
    {
      "title": "create-api-documentation",
      "type": "agent",
      "depends_on": ["create-api-endpoints"],
      "prompt": "Create comprehensive API documentation:\n\n- Write OpenAPI 3.0 specification in `docs/openapi.yaml`\n- Document all endpoints with request/response schemas\n- Include authentication requirements for each endpoint\n- Add example requests and responses\n- Set up Swagger UI endpoint at `/api-docs`\n- Create API usage guide in `docs/API_GUIDE.md`"
    },
    {
      "title": "implement-tests",
      "type": "agent",
      "depends_on": ["implement-auth-service", "create-api-endpoints"],
      "prompt": "Create comprehensive test suite:\n\n- Write unit tests for auth service in `tests/services/auth.service.test.ts`\n- Create integration tests for all API endpoints in `tests/integration/`\n- Add test fixtures and mock data in `tests/fixtures/`\n- Implement test utilities for JWT token generation in `tests/utils/`\n- Configure Jest with proper test environment setup\n- Ensure minimum 80% code coverage"
    },
    {
      "title": "final-review",
      "type": "oneshot",
      "depends_on": ["setup-database", "implement-auth-service", "create-api-endpoints", "add-file-upload", "create-api-documentation", "implement-tests"],
      "prompt": "Review the complete User Profile API implementation:\n\n- Verify all requirements from the spec are met\n- Check security best practices are followed\n- Validate database schema matches the refined design\n- Ensure proper error handling throughout the codebase\n- Confirm API documentation is complete and accurate\n- Generate a summary report of the implementation"
    }
  ]
}